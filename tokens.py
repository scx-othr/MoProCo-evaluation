#!/usr/bin/env python3
import sys
from pathlib import Path

def eval_count(path):
    result = 0
    with open(path, encoding="utf-8", errors="ignore") as f:
        for line in f.readlines():
            if "\"eval_count\"" in line:
                result += int(line.split('"eval_count":')[1].split(',')[0])
    return result

if __name__ == "__main__":
    print("# Token metrics")
    print("generated by [tokens.py](tokens.py)")
    print()
    for casestudy in ["airline", "library", "shop"]:
        print("## " + casestudy)
        print()
        print("### Black-box LLM code generation: generated tokens")
        for run in [str(i) for i in range(1, 6)]:
            path = Path(casestudy + "/blackbox-llm/" + run + "/usage.json")
            print("- run " + run + ": " + str(eval_count(path)))
        print()
        print("### MoProCo code generation (LLM phase): generated tokens")
        for run in [str(i) for i in range(1, 6)]:
            path = Path(casestudy + "/moproco/" + run + "/log.txt")
            print("- run " + run + ": " + str(eval_count(path)))
        print()     
