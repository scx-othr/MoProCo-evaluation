@startuml
title Member::returnCopy(copy : Copy)

start
if (not copy.loans.exists(l | l.member = this and l.copy = copy and l.closed = false)) then ([true])
  :raise("Copy is not borrowed by this member.");
  stop
else ([false])
  :l := copy.loans->select(l | l.member = this and l.copy = copy and l.closed = false)->first();
  if (copy.loan.returnDate.isAfter(copy.loan.dueDate)) then ([true])
    :println("Loan has been exceeded!");
  else ([false])
  endif
  :l.returnDate := now();
  :l.closed := true;
  :copy.status := BookStatus::Available;
stop
@enduml
