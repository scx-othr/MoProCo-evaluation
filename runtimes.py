#!/usr/bin/env python3
import sys
from pathlib import Path

def runtime(path):
    result = 0
    with open(path, encoding="utf-8", errors="ignore") as f:
        for line in f.readlines():
            if "\"total_duration\"" in line:
                result += int(line.split('"total_duration":')[1].split(',')[0])
    return "{:.2f}".format(result / 1000000000)

if __name__ == "__main__":
    print("# Runtime metrics")
    print("generated by [runtimes.py](runtimes.py)")
    print()
    for casestudy in ["airline", "library", "shop"]:
        print("## " + casestudy)
        print()
        print("### Black-box LLM code generation: runtime [s]")
        for run in [str(i) for i in range(1, 6)]:
            path = Path(casestudy + "/blackbox-llm/" + run + "/usage.json")
            print("- run " + run + ": " + str(runtime(path)))
        print()
        print("### MoProCo code generation (LLM phase): runtime [s]")
        for run in [str(i) for i in range(1, 6)]:
            path = Path(casestudy + "/moproco/" + run + "/log.txt")
            print("- run " + run + ": " + str(runtime(path)))
        print()     
